<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      href="https://getbootstrap.com/docs/5.3/assets/css/docs.css"
      rel="stylesheet"
    />
    <link
      href="./styles.css"
      rel="stylesheet"
    />
    <link href="https://fonts.cdnfonts.com/css/adobe-clean" rel="stylesheet">
                
    <title>Youtube Animation</title>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <style>
      svg{
        width: '100%' !important;
      }
    </style>
  </head>
  <body>
    <h2 style="color: white; display: none" id="currentState"></h2>
            
    <p style="color: white; display: none" id="frame">0</p>
    <p style="color: white; display: none" id="stopValue">0</p>
      <lottie-player
        id="blueprint-lottie-5"
        style="cursor: pointer; width: 250px;"
        src="https://raw.githubusercontent.com/NicholasWM/fundamental_block_3.0/master/public/InscritoYoutube.json"
        onclick="subscribeIfCurrentStateIsUnsubscribed()"
      >"></lottie-player>

    <ul class="dropdown-menu">
      <li>
        <a onclick="allNotifications()" class="dropdown-item" href="#">
          <img src = "./assets/sinoTodas.svg" alt="My Happy SVG"/>
          Todas
        </a>
      </li>
      <li onclick="customNotifications()">
        <a onclick="customNotifications()" class="dropdown-item" href="#">
        <img src = "./assets/sinoPersonalizadas.svg" alt="My Happy SVG"/>
        Personalizadas
      </a></li>
      <li><a onclick="noNotifications()" class="dropdown-item" href="#">
        <img src = "./assets/sinoNenhuma.svg" alt="My Happy SVG"/>
        Nenhuma
      </a></li>
      <li><a onclick="unsubscribe()" class="dropdown-item" href="#">
        <img src = "./assets/cancelarInscricao.svg" alt="My Happy SVG"/>
        Cancelar Inscrição
      </a></li>
    </ul>
    <script type="text/javascript" src="https://unpkg.com/lottie-interactive@latest/dist/lottie-interactive.js"></script>
    <script src="https://unpkg.com/@lottiefiles/lottie-player@latest/dist/lottie-player.js"></script>
    <script src="https://unpkg.com/@lottiefiles/lottie-interactivity@latest/dist/lottie-interactivity.min.js"></script>
    <script type="text/javascript">
      const lottiePlayer = document.getElementById('blueprint-lottie-5')
      const frameElement = document.getElementById('frame')
      const stopValueElement = document.getElementById('stopValue')
      const currentStateElement = document.getElementById('currentState')

      let subscribeBtn = lottiePlayer.shadowRoot.getElementById('boxInscrever')
      let subscribedBtn = lottiePlayer.shadowRoot.getElementById('boxInscrito')

      // var sheet = new CSSStyleSheet
      // sheet.replaceSync( `path { fill: pink }`)
      // subscribeBtn.adoptedStyleSheets.push(sheet) 

      // subscribeBtn.appendChild(style)

      currentStateElement.innerText = 'unsubscribed'

      const stopFrameMapper = {
        106: 'subscribed',
        21: 'unsubscribed',
        191: 'noNotifications',
        276: 'allNotifications',
        361: 'customNotifications',
      }

      lottiePlayer.shadowRoot.getElementById('animation-container').style.width = '100%'

      function changeLottiePlayerOnClickBehavior() {
        if (currentStateElement.innerText === 'unsubscribed') {
          lottiePlayer.setAttribute('data-bs-toggle', '')
        } else {
          lottiePlayer.setAttribute('data-bs-toggle', 'dropdown')
        }
      }

      function subscribeIfCurrentStateIsUnsubscribed() {
        if (currentStateElement.innerText === 'unsubscribed') {
          subscribe()
        }
        changeLottiePlayerOnClickBehavior()
      }


      function animate(initialFrame, lastFrame) {
        currentStateElement.innerText = Object.keys(stopFrameMapper).includes(String(lastFrame)) ? stopFrameMapper[lastFrame] : 'Not Mapped'
        if(initialFrame > lastFrame) {
          lottiePlayer._lottie.setDirection(-1)
        } else {
          lottiePlayer._lottie.setDirection(1)
        }

        stopValueElement.innerText = lastFrame
        lottiePlayer._lottie.goToAndPlay(initialFrame, true)
      }

      function subscribe() {
        console.log('subscribe');
        animate(22, 106)

        subscribeBtn.style.pointerEvents = 'none'
        subscribedBtn = lottiePlayer.shadowRoot.getElementById('boxInscrito')
        subscribedBtn.style.pointerEvents = 'auto'

        addHover('boxInscrito', '#AAAABE', '#D9D9E1')
      }
      function unsubscribe() {
        console.log('unsubscribe');
        animate(1, 21)

        subscribedBtn.style.pointerEvents = 'none'
        subscribeBtn = lottiePlayer.shadowRoot.getElementById('boxInscrever')
        subscribeBtn.style.pointerEvents = 'auto'

        addHover('boxInscrever', '#F2F3F7', '#AAAABE')
      }
      function noNotifications() {console.log('noNotifications');animate(107, 191)}
      function allNotifications() {console.log('allNotifications');animate(192, 276)}
      function customNotifications() {console.log('customNotifications');animate(277, 361)}

      lottiePlayer.addEventListener("frame", (e) => {
        const frame = Number(e.target._lottie.currentFrame.toFixed(0))
        
        frameElement.innerText = frame
        const lastFrame = Number(stopValueElement.innerText)
        if(frame === lastFrame) {
          lottiePlayer._lottie.goToAndStop(lastFrame, true)
        }
      });

      function addHover(id, initialColor, onHoverColor) {
        let targetElement = lottiePlayer.shadowRoot.getElementById(id)

        targetElement.addEventListener('mouseover', () => {
          targetElement = lottiePlayer.shadowRoot.getElementById(id).querySelector('g').querySelector('path')
          targetElement.style.fill = onHoverColor
        })
        targetElement.addEventListener('mouseout', () => {
          console.log('mouseout')
          targetElement.style.fill = initialColor
        })
      }

      setTimeout(() => {
        lottiePlayer._lottie.goToAndStop(0)

        lottiePlayer.style.pointerEvents = 'none'

        subscribeBtn = lottiePlayer.shadowRoot.getElementById('boxInscrever')

        addHover('boxInscrever', '#F2F3F7', '#AAAABE')

        subscribeBtn.style.pointerEvents = 'auto'
        
      }, 100)
  </script>

    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js"
      integrity="sha384-I7E8VVD/ismYTF4hNIPjVp/Zjvgyol6VFvRkX/vR+Vc4jQkC+hVqc2pM8ODewa9r"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.min.js"
      integrity="sha384-0pUGZvbkm6XF6gxjEnlmuGrJXVbNuzT9qBBavbLwCsOGabYfZo0T0to5eqruptLy"
      crossorigin="anonymous"
    ></script>
  </body>
</html>
