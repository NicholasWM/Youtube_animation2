<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      href="https://getbootstrap.com/docs/5.3/assets/css/docs.css"
      rel="stylesheet"
    />
    <link
      href="./styles.css"
      rel="stylesheet"
    />
    <link href="https://fonts.cdnfonts.com/css/adobe-clean" rel="stylesheet">
                
    <title>Bootstrap Example</title>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  </head>
  <body>
    <h2 style="color: white" id="currentState"></h2>
            
    <p style="color: white" id="frame">0</p>
    <p style="color: white" id="stopValue">0</p>
      <lottie-player
        id="blueprint-lottie-5"
        style="width: '100%'; border: black solid 1px;"
        src="https://raw.githubusercontent.com/NicholasWM/fundamental_block_3.0/master/public/InscritoYoutube.json"
        onclick="subscribeIfCurrentStateIsUnsubscribed()"
        class="m-auto justify-content-center"
      >"></lottie-player>

    <ul class="dropdown-menu">
      <li>
        <a onclick="allNotifications()" class="dropdown-item" href="#">
          <img src = "./assets/sinoTodas.svg" alt="My Happy SVG"/>
          Todas
        </a>
      </li>
      <li onclick="customNotifications()">
        <a onclick="customNotifications()" class="dropdown-item" href="#">
        <img src = "./assets/sinoPersonalizadas.svg" alt="My Happy SVG"/>
        Personalizadas
      </a></li>
      <li><a onclick="noNotifications()" class="dropdown-item" href="#">
        <img src = "./assets/sinoNenhuma.svg" alt="My Happy SVG"/>
        Nenhuma
      </a></li>
      <li><a onclick="unsubscribe()" class="dropdown-item" href="#">
        <img src = "./assets/cancelarInscricao.svg" alt="My Happy SVG"/>
        Cancelar Inscrição
      </a></li>
    </ul>
    <script type="text/javascript" src="https://unpkg.com/lottie-interactive@latest/dist/lottie-interactive.js"></script>
    <script src="https://unpkg.com/@lottiefiles/lottie-player@latest/dist/lottie-player.js"></script>
    <script src="https://unpkg.com/@lottiefiles/lottie-interactivity@latest/dist/lottie-interactivity.min.js"></script>
    <script type="text/javascript">
      const lottiePlayer = document.getElementById('blueprint-lottie-5')
      const frameElement = document.getElementById('frame')
      const stopValueElement = document.getElementById('stopValue')
      const currentStateElement = document.getElementById('currentState')

      currentStateElement.innerText = 'unsubscribed'

      const stopFrameMapper = {
        106: 'subscribed',
        21: 'unsubscribed',
        191: 'noNotifications',
        276: 'allNotifications',
        361: 'customNotifications',
      }

      function changeLottiePlayerOnClickBehavior() {
        if (currentStateElement.innerText === 'unsubscribed') {
          lottiePlayer.setAttribute('data-bs-toggle', '')
        } else {
          lottiePlayer.setAttribute('data-bs-toggle', 'dropdown')
        }
      }

      function subscribeIfCurrentStateIsUnsubscribed() {
        if (currentStateElement.innerText === 'unsubscribed') {
          subscribe()
        }
        changeLottiePlayerOnClickBehavior()
      }


      function animate(initialFrame, lastFrame) {
        currentStateElement.innerText = Object.keys(stopFrameMapper).includes(String(lastFrame)) ? stopFrameMapper[lastFrame] : 'Not Mapped'
        if(initialFrame > lastFrame) {
          lottiePlayer._lottie.setDirection(-1)
        } else {
          lottiePlayer._lottie.setDirection(1)
        }

        stopValueElement.innerText = lastFrame
        lottiePlayer._lottie.goToAndPlay(initialFrame, true)
        // changeLottiePlayerOnClickBehavior()
      }

      // Faltam
      // inscrito -> inscritoTodas
      // inscrito -> inscritoPersonalizado
      // inscritoNenhuma -> inscritoPersonalizado

      // subscribed - unsubscribed
      // subscribed - noNotifications
      // subscribed - allNotifications
      // subscribed - customNotifications

      // unsubscribed - noNotifications
      // unsubscribed - allNotifications
      // unsubscribed - customNotifications

      // noNotifications
      // allNotifications
      // customNotifications

      function subscribe() {console.log('subscribe');animate(22, 106)}
      function unsubscribe() {console.log('unsubscribe');animate(1, 21)}
      function noNotifications() {console.log('noNotifications');animate(107, 191)}
      function allNotifications() {console.log('allNotifications');animate(192, 276)}
      function customNotifications() {console.log('customNotifications');animate(277, 361)}

      lottiePlayer.addEventListener("frame", (e) => {
        const frame = Number(e.target._lottie.currentFrame.toFixed(0))
        
        frameElement.innerText = frame
        const lastFrame = Number(stopValueElement.innerText)
        if(frame === lastFrame) {
          lottiePlayer._lottie.goToAndStop(lastFrame, true)
        }
      });

      setTimeout(() => {
        lottiePlayer._lottie.goToAndStop(0)
      }, 1000)
  </script>

    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js"
      integrity="sha384-I7E8VVD/ismYTF4hNIPjVp/Zjvgyol6VFvRkX/vR+Vc4jQkC+hVqc2pM8ODewa9r"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.min.js"
      integrity="sha384-0pUGZvbkm6XF6gxjEnlmuGrJXVbNuzT9qBBavbLwCsOGabYfZo0T0to5eqruptLy"
      crossorigin="anonymous"
    ></script>
  </body>
</html>
